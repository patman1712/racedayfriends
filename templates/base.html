<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RaceDayFriends | Official eSports Team</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/hero.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/intro.css') }}">
    <!-- Google Fonts: Teko (Headings) & Rajdhani (Tech/UI) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;600;700&family=Teko:wght@300;400;600;700&family=Dancing+Script:wght@700&family=Great+Vibes&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Flag Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/6.6.6/css/flag-icons.min.css">
</head>
<body>

    <!-- Preloader Intro -->
    <div id="preloader">
        <div class="intro-logo">
            <!-- Logo eingebunden -->
            <img src="{{ url_for('static', filename='img/logo.png') }}" alt="RaceDayFriends" style="width: 250px; height: auto; filter: drop-shadow(0 0 20px rgba(79, 209, 197, 0.4));">
        </div>
        <div class="loader-track">
            <div class="loader-bar"></div>
        </div>
        <div class="loader-text">Die Motoren werden gestartet...</div>
    </div>

    <!-- Header / Navigation -->
    <header>
        <nav>
            <a href="/" class="nav-logo">
                {% if site_config.nav_logo_url %}
                <img src="{{ site_config.nav_logo_url }}" alt="RaceDayFriends" style="height: 40px; width: auto;">
                {% else %}
                <img src="{{ url_for('static', filename='img/logo.png') }}" alt="RaceDayFriends" style="height: 40px; width: auto;">
                {% endif %}
            </a>
            
            <!-- Mobile Menu Toggle -->
            <div class="hamburger" onclick="toggleMenu()">
                <span></span>
                <span></span>
                <span></span>
            </div>

            <ul class="nav-links" id="nav-menu">
                {% if site_config.navigation %}
                    {% for item in site_config.navigation %}
                    <li><a href="{{ item.link }}" onclick="toggleMenu()">{{ item.text }}</a></li>
                    {% endfor %}
                {% else %}
                    <!-- Fallback Navigation, falls Config leer ist -->
                    <li><a href="/" onclick="toggleMenu()">Home</a></li>
                    <li><a href="/team" onclick="toggleMenu()">Das Team</a></li>
                    <li><a href="/#news" onclick="toggleMenu()">News</a></li>
                    <li><a href="/gallery" onclick="toggleMenu()">Galerie</a></li>
                    <li><a href="/calendar" onclick="toggleMenu()">Rennkalender</a></li>
                {% endif %}
                
                {% if session.get('driver_logged_in') %}
                <li><a href="/boxengasse" onclick="toggleMenu()" style="color: var(--rdf-teal); font-weight: bold;"><i class="fas fa-wrench"></i> Boxengasse</a></li>
                {% else %}
                <li><a href="/login" onclick="toggleMenu()" class="login-link"><i class="fas fa-sign-in-alt"></i> Login</a></li>
                {% endif %}
            </ul>
        </nav>
    </header>

    <!-- Main Content Injection -->
    <main>
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <div class="logo-container">
                <h3>RACEDAY<span style="color: var(--rdf-teal);">FRIENDS</span></h3>
            </div>
            <div class="social-links">
                {% if site_config.social_discord %}<a href="{{ site_config.social_discord }}" target="_blank"><i class="fab fa-discord"></i></a>{% endif %}
                {% if site_config.social_instagram %}<a href="{{ site_config.social_instagram }}" target="_blank"><i class="fab fa-instagram"></i></a>{% endif %}
                {% if site_config.social_twitter %}<a href="{{ site_config.social_twitter }}" target="_blank"><i class="fab fa-twitter"></i></a>{% endif %}
                {% if site_config.social_twitch %}<a href="{{ site_config.social_twitch }}" target="_blank"><i class="fab fa-twitch"></i></a>{% endif %}
                {% if site_config.social_youtube %}<a href="{{ site_config.social_youtube }}" target="_blank"><i class="fab fa-youtube"></i></a>{% endif %}
            </div>
            <p style="color: var(--rdf-silver); font-size: 0.8rem;">
                &copy; 2026 RaceDayFriends eSports. All rights reserved.<br>
                Not affiliated with iRacing.com Motorsport Simulations.
            </p>
        </div>
    </footer>

    <script>
        // Mobile Menu Toggle
        function toggleMenu() {
            const nav = document.getElementById('nav-menu');
            const burger = document.querySelector('.hamburger');
            
            // Nur auf Mobile togglen
            if (window.innerWidth <= 768) {
                nav.classList.toggle('active');
                burger.classList.toggle('active');
            }
        }

        // Intro Animation Logic
        window.addEventListener('load', function() {
            const preloader = document.getElementById('preloader');
            
            // 0. Wo sind wir?
            const isHome = window.location.pathname === '/';
            const hasHash = window.location.hash.length > 0;
            
            // Wenn wir auf einer Unterseite sind ODER einen Anker-Link haben (z.B. /#news) -> KEIN Intro
            if (!isHome || hasHash) {
                // Sofort ausblenden
                preloader.style.display = 'none';
                document.body.classList.add('loaded');
                return;
            }

            let showIntro = true;
            
            // 1. Haben wir das Intro in diesem Tab schon gesehen?
            const introSeen = sessionStorage.getItem('intro_seen');

            // 2. Wie wurde die Seite geladen?
            let navType = 'navigate';
            try {
                const navEntries = performance.getEntriesByType("navigation");
                if (navEntries.length > 0) {
                    navType = navEntries[0].type;
                }
            } catch (e) {
                console.log("Navigation API not supported", e);
            }

            // 3. Entscheidung treffen
            if (navType === 'reload') {
                // Bei F5 / Refresh: IMMER Intro zeigen
                showIntro = true;
                // Bei Reload wollen wir es ja nochmal sehen, also flag temporär ignorieren
                // Aber wir müssen es danach wieder setzen
            } else if (navType === 'back_forward') {
                // Bei Zurück: NIE Intro
                showIntro = false;
            } else {
                // Bei normaler Navigation (Link):
                if (introSeen) {
                    showIntro = false;
                } else {
                    showIntro = true;
                }
            }

            if (!showIntro) {
                // Sofort ausblenden (keine Animation)
                preloader.style.display = 'none';
                document.body.classList.add('loaded');
                // Sicherstellen, dass Flag gesetzt ist (falls Back-Button Navigation)
                sessionStorage.setItem('intro_seen', 'true');
            } else {
                // Intro abspielen
                // WICHTIG: Flag SOFORT setzen, damit beim nächsten Klick (auch während Intro)
                // das Intro nicht nochmal kommt.
                sessionStorage.setItem('intro_seen', 'true');
                
                setTimeout(function() {
                    document.body.classList.add('loaded');
                    setTimeout(() => {
                        preloader.style.display = 'none';
                    }, 800);
                }, 2500);
            }
        });
    </script>

</body>
</html>