{% extends "base.html" %}

{% block content %}
<div class="driver-profile-container">
    
    <!-- Header Section -->
    <div class="driver-header">
        <div class="driver-bg"></div>
        <div class="container" style="position: relative; z-index: 2; height: 100%; display: flex; align-items: flex-end; padding-bottom: 40px;">
            <div class="driver-intro">
                <h1 class="driver-name-lg">{{ driver.name }}</h1>
                <div class="driver-meta">
                    <span class="team-role">{{ driver.role or 'Driver' }}</span>
                    {% if driver.nationality %}
                    <span class="fi fi-{{ driver.nationality.lower() }}"></span>
                    {% endif %}
                </div>
            </div>
            <div class="driver-number-lg">{{ driver.number or '00' }}</div>
        </div>
    </div>

    <div class="container" style="margin-top: 40px; margin-bottom: 80px;">
        <div class="profile-grid">
            
            <!-- Left Column: Stats & Info -->
            <div class="profile-left">
                <!-- Driver Image Card -->
                <div class="driver-card-pro" style="height: 350px; margin-bottom: 30px;">
                    <div class="card-bg"></div>
                    <div class="driver-image">
                        {% if driver.image_url %}
                        <img src="{{ driver.image_url }}" alt="{{ driver.name }}">
                        {% else %}
                        <i class="fas fa-user" style="font-size: 150px; color: rgba(255,255,255,0.05);"></i>
                        {% endif %}
                    </div>
                </div>

                <div class="stat-card">
                    <h3>iRating</h3>
                    <div class="stat-value">{{ driver.ir_sports or '-' }}</div>
                </div>
                <div class="stat-card">
                    <h3>Safety Rating</h3>
                    <div class="stat-value">{{ driver.sr_sports or '-' }}</div>
                </div>
                
                {% if driver.twitch %}
                <a href="{{ driver.twitch }}" target="_blank" class="twitch-btn">
                    <i class="fab fa-twitch"></i> Watch on Twitch
                </a>
                {% endif %}
            </div>

            <!-- Right Column: Content -->
            <div class="profile-right">
                
                <!-- 1. Sim Rig Showcase -->
                {% if driver.rig %}
                <div class="rig-showcase" style="margin-bottom: 40px;">
                    <h2 class="section-title"><i class="fas fa-gamepad"></i> My Sim Rig</h2>
                    <!-- ... (Rig Specs & Gallery bleiben gleich) ... -->
                    <div class="rig-specs">
                        {% if driver.rig.type %}
                        <div class="spec-item">
                            <span class="spec-label">Cockpit</span>
                            <span class="spec-value">{{ driver.rig.type }}</span>
                        </div>
                        {% endif %}
                        <!-- ... restliche Specs ... -->
                        {% if driver.rig.monitors %}
                        <div class="spec-item">
                            <span class="spec-label">Monitors</span>
                            <span class="spec-value">{{ driver.rig.monitors }}</span>
                        </div>
                        {% endif %}
                        {% if driver.rig.base %}
                        <div class="spec-item">
                            <span class="spec-label">Wheelbase</span>
                            <span class="spec-value">{{ driver.rig.base }}</span>
                        </div>
                        {% endif %}
                        {% if driver.rig.wheel %}
                        <div class="spec-item">
                            <span class="spec-label">Steering Wheel</span>
                            <span class="spec-value">{{ driver.rig.wheel }}</span>
                        </div>
                        {% endif %}
                        {% if driver.rig.pedals %}
                        <div class="spec-item">
                            <span class="spec-label">Pedals</span>
                            <span class="spec-value">{{ driver.rig.pedals }}</span>
                        </div>
                        {% endif %}
                        {% if driver.rig.extras %}
                        <div class="spec-item">
                            <span class="spec-label">Extras</span>
                            <span class="spec-value">{{ driver.rig.extras }}</span>
                        </div>
                        {% endif %}
                    </div>

                    <!-- Rig Photos -->
                    {% if driver.rig.images %}
                    <div class="rig-gallery">
                        {% for img in driver.rig.images %}
                        <a href="#img-{{ loop.index }}" class="rig-thumb">
                            <img src="{{ img }}" alt="Sim Rig Setup">
                        </a>
                        <div id="img-{{ loop.index }}" class="lightbox">
                            <a href="#!" class="close-lightbox"></a>
                            <div class="lightbox-content">
                                <img src="{{ img }}" alt="Sim Rig Setup">
                                <a href="#!" class="close-btn">&times;</a>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
                {% endif %}

                <!-- 2. Upcoming Events -->
                {% if upcoming_events %}
                <h2 class="section-title"><i class="fas fa-calendar-alt"></i> Next Races</h2>
                <div class="events-list">
                    {% for event in upcoming_events %}
                    <a href="/news/{{ event.id }}" class="event-item">
                        <div class="event-date">
                            <span class="day">{{ event.date.split('T')[0].split('-')[2] }}</span>
                            <span class="month">{{ event.date.split('T')[0].split('-')[1] }}</span>
                        </div>
                        <div class="event-info">
                            <h4>{{ event.title }}</h4>
                            <p>{{ event.track }} | {{ event.car_class }}</p>
                        </div>
                        <div class="event-arrow"><i class="fas fa-chevron-right"></i></div>
                    </a>
                    {% endfor %}
                </div>
                {% endif %}

                <!-- 3. Past Races (Results) -->
                {% if past_events %}
                <h2 class="section-title" style="margin-top: 40px;"><i class="fas fa-flag-checkered"></i> Recent Results</h2>
                <div class="results-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Event</th>
                                <th>Track</th>
                                <th>Car</th>
                                <th>Result</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for event in past_events %}
                            <tr>
                                <td>{{ event.date.split('T')[0] }}</td>
                                <td><a href="/news/{{ event.id }}" style="color: white;">{{ event.title }}</a></td>
                                <td>{{ event.track }}</td>
                                <td>{{ event.car_model }}</td>
                                <td>
                                    {% if event.result %}
                                    <span class="result-badge">{{ event.result }}</span>
                                    {% else %}
                                    <span style="color: var(--rdf-silver);">-</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% endif %}

            </div>
        </div>
    </div>
</div>

<style>
    /* ... (CSS f√ºr Header und Grid bleibt) ... */
    
    /* Driver Image Card (from Team Page) */
    .driver-card-pro {
        position: relative; background: #0B1829; border-radius: 16px; overflow: hidden;
        border: 1px solid rgba(79, 209, 197, 0.1);
    }
    .card-bg {
        position: absolute; top: 0; right: 0; width: 60%; height: 100%;
        background-image: radial-gradient(var(--rdf-teal) 1px, transparent 1px);
        background-size: 8px 8px; opacity: 0.1;
        mask-image: linear-gradient(to left, black, transparent); -webkit-mask-image: linear-gradient(to left, black, transparent);
    }
    .driver-image {
        position: absolute; bottom: 0; right: -10px; height: 95%; width: 100%;
        display: flex; align-items: flex-end; justify-content: center; z-index: 1;
    }
    .driver-image img {
        max-height: 100%; max-width: 100%; object-fit: contain;
        filter: drop-shadow(-5px 0 10px rgba(0,0,0,0.5));
    }

    /* Events List */
    .events-list { display: flex; flex-direction: column; gap: 15px; }
    .event-item {
        display: flex; align-items: center; background: #15273d; padding: 15px; border-radius: 8px;
        text-decoration: none; border-left: 4px solid var(--rdf-teal); transition: transform 0.2s;
    }
    .event-item:hover { transform: translateX(5px); background: #1a3a5a; }
    .event-date {
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        background: #0B1829; padding: 10px; border-radius: 4px; min-width: 60px; margin-right: 20px;
    }
    .event-date .day { font-size: 1.2rem; font-weight: bold; color: white; line-height: 1; }
    .event-date .month { font-size: 0.8rem; color: var(--rdf-teal); text-transform: uppercase; }
    .event-info h4 { margin: 0; color: white; font-size: 1.1rem; }
    .event-info p { margin: 5px 0 0; color: var(--rdf-silver); font-size: 0.9rem; }
    .event-arrow { margin-left: auto; color: var(--rdf-teal); }

    /* Results Table */
    .results-table { overflow-x: auto; }
    table { width: 100%; border-collapse: collapse; }
    th { text-align: left; padding: 15px; color: var(--rdf-silver); font-size: 0.8rem; text-transform: uppercase; border-bottom: 1px solid rgba(255,255,255,0.1); }
    td { padding: 15px; border-bottom: 1px solid rgba(255,255,255,0.05); color: white; }
    .result-badge {
        background: rgba(79, 209, 197, 0.2); color: var(--rdf-teal); padding: 5px 10px; border-radius: 4px; font-weight: bold;
    }
</style>
{% endblock %}