{% extends "base.html" %}

{% block content %}
<!-- Custom Driver Detail CSS -->
<style>
    /* Global Page Override for this view */
    body { background-color: #050b14; }
    
    .dd-container {
        max-width: 1400px; margin: 0 auto; padding: 0 40px;
    }

    /* HEADER SECTION */
    .dd-header {
        position: relative;
        height: 85vh;
        min-height: 600px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding-top: 80px;
        overflow: hidden;
        /* Hellerer, blauerer Verlauf wie im Screenshot */
        background: linear-gradient(135deg, #0B1829 0%, #15273d 100%);
    }

    /* Dotted Pattern Overlay (Stärker sichtbar) */
    .dd-header::before {
        content: "";
        position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        background-image: radial-gradient(rgba(255, 255, 255, 0.1) 1.5px, transparent 1.5px);
        background-size: 20px 20px;
        opacity: 0.5;
        pointer-events: none;
        z-index: 1;
    }
    
    /* Background Number (21) */
    .dd-bg-number {
        position: absolute;
        top: 50%; right: 15%;
        transform: translateY(-50%);
        font-family: 'Teko', sans-serif;
        font-size: 700px;
        font-weight: 700;
        color: rgba(0, 0, 0, 0.2); /* Dunkler als Background */
        line-height: 1;
        z-index: 0;
        pointer-events: none;
    }

    /* Left Info */
    .dd-info {
        position: relative; z-index: 2;
        padding-left: 10%;
        width: 40%;
        display: flex; flex-direction: column; justify-content: center;
    }
    
    /* Racing Stripes (Alonso Style) */
    .dd-stripes-top {
        display: flex; gap: 10px; margin-bottom: 20px;
        transform: skewY(-20deg); /* Leicht schräg */
    }
    .stripe {
        width: 15px; height: 80px; background: white;
        clip-path: polygon(0 0, 100% 0, 100% 80%, 0 100%); /* Schräge Kante unten */
    }
    .stripe.short { height: 50px; background: var(--rdf-teal); }
    
    .dd-stripes-bottom {
        display: flex; gap: 10px; margin-top: 20px;
        transform: skewY(-20deg);
    }
    .stripe-b {
        width: 15px; height: 80px; background: white;
        clip-path: polygon(0 20%, 100% 0, 100% 100%, 0 100%); /* Schräge Kante oben */
    }
    .stripe-b.short { height: 50px; background: var(--rdf-teal); clip-path: polygon(0 30%, 100% 0, 100% 100%, 0 100%); }

    /* Name Styles */
    .dd-name { line-height: 0.8; margin-bottom: 20px; }
    .dd-firstname-style {
        font-family: 'Great Vibes', cursive; font-size: 5rem; color: white; display: block; margin-left: 10px; margin-bottom: 10px;
    }
    .dd-lastname {
        font-family: 'Teko', sans-serif; font-size: 7rem; color: white; /* Weiss wie im Alonso Bild */
        font-weight: 800; text-transform: uppercase; display: block; letter-spacing: 2px;
    }
    
    /* Meta Line */
    .dd-meta {
        display: flex; align-items: center; gap: 25px; margin-top: 10px;
        font-family: 'Rajdhani', sans-serif; font-size: 1.3rem; color: white; font-weight: 600;
        position: relative; z-index: 3;
    }
    .dd-meta span { display: flex; align-items: center; gap: 10px; }
    
    /* FIX: Runde Flagge */
    .dd-meta .fi {
        display: inline-block;
        width: 32px !important; height: 32px !important;
        border-radius: 50% !important;
        background-size: cover; background-position: center;
        box-shadow: 0 0 0 2px white; /* Weißer Ring */
        flex-shrink: 0;
    }
    .dd-meta .highlight { color: var(--rdf-teal); font-weight: bold; font-size: 1.3rem; letter-spacing: 1px; }
    .separator { color: #4a5568; font-weight: 300; opacity: 0.5; }

    /* Right Image */
    .dd-image {
        position: absolute;
        right: 10%; bottom: 0;
        height: 85%; width: 40%;
        z-index: 2;
        display: flex; align-items: flex-end; justify-content: center;
    }
    .dd-image img {
        max-height: 100%; width: auto; object-fit: contain;
        filter: drop-shadow(0 10px 30px rgba(0,0,0,0.5));
    }

    /* Sim Rig Box */
    .dd-rig-section {
        margin-top: 60px;
        background: #0B1829;
        border: 1px solid var(--rdf-teal); /* Teal Border wie gewünscht */
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    }
    .dd-rig-header {
        background: rgba(79, 209, 197, 0.1);
        padding: 20px 30px;
        border-bottom: 1px solid var(--rdf-teal);
        display: flex; align-items: center; gap: 15px;
    }
    .dd-rig-header h2 {
        margin: 0; color: white; font-family: 'Teko', sans-serif; font-size: 2.5rem; text-transform: uppercase;
    }
    .dd-rig-content { padding: 30px; }

    /* TWITCH BAR */
    .dd-twitch-bar {
        background: #0B1829;
        border: 1px solid #1a2a40;
        border-radius: 8px;
        padding: 15px 30px;
        display: flex; justify-content: space-between; align-items: center;
        margin-bottom: 60px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    }
    .dd-twitch-user {
        display: flex; align-items: center; gap: 15px;
        font-family: 'Teko', sans-serif; font-size: 1.5rem; color: white; text-transform: uppercase;
    }
    .dd-twitch-icon {
        color: #9146FF; font-size: 1.8rem;
    }
    .dd-twitch-status {
        display: flex; align-items: center; gap: 20px;
    }
    .status-badge {
        background: rgba(255,255,255,0.1); color: var(--rdf-silver);
        padding: 5px 15px; border-radius: 20px; font-size: 0.8rem; font-weight: bold;
        display: flex; align-items: center; gap: 8px; text-transform: uppercase;
    }
    .status-dot { width: 8px; height: 8px; background: var(--rdf-silver); border-radius: 50%; }
    .status-badge.live { background: rgba(255, 0, 0, 0.2); color: #ff4d4d; }
    .status-badge.live .status-dot { background: #ff4d4d; box-shadow: 0 0 10px #ff4d4d; }
    
    .twitch-link-btn {
        color: var(--rdf-silver); text-decoration: none; font-size: 0.9rem;
        display: flex; align-items: center; gap: 8px; transition: color 0.2s;
    }
    .twitch-link-btn:hover { color: white; }

    /* SECTIONS */
    .dd-section-title {
        font-family: 'Teko', sans-serif; font-size: 3rem; color: white; text-transform: uppercase;
        margin-bottom: 30px; padding-left: 20px; border-left: 5px solid var(--rdf-teal); line-height: 1;
    }

    /* TABLE */
    .dd-table-container {
        background: #0B1829; border: 1px solid #1a2a40; border-radius: 8px; overflow: hidden;
        margin-bottom: 60px;
    }
    .dd-table { width: 100%; border-collapse: collapse; }
    .dd-table th {
        text-align: left; padding: 20px; background: #0f1c2e; color: white; font-weight: 700;
        text-transform: uppercase; font-size: 0.9rem; border-bottom: 1px solid #1a2a40;
    }
    .dd-table td {
        padding: 20px; border-bottom: 1px solid #1a2a40; color: var(--rdf-silver); font-size: 0.95rem;
    }
    .dd-table tr:last-child td { border-bottom: none; }
    .dd-table tr:hover td { background: rgba(255,255,255,0.02); color: white; }
    
    .res-badge { color: var(--rdf-teal); font-weight: bold; }
    
    /* RIG SECTION (New) */
    .dd-rig-grid {
        display: grid; grid-template-columns: 1fr 1fr; gap: 40px; margin-bottom: 80px;
    }
    .dd-rig-specs {
        background: #0B1829; padding: 30px; border-radius: 8px; border: 1px solid #1a2a40;
    }
    .spec-row {
        display: flex; justify-content: space-between; padding: 15px 0; border-bottom: 1px solid rgba(255,255,255,0.05);
    }
    .spec-row:last-child { border-bottom: none; }
    .spec-key { color: var(--rdf-silver); text-transform: uppercase; font-size: 0.9rem; }
    .spec-val { color: white; font-weight: 600; text-align: right; }
    
    .dd-rig-gallery {
        display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;
    }
    .rig-img-lg {
        grid-column: span 2; height: 300px; border-radius: 8px; overflow: hidden; border: 1px solid #1a2a40;
    }
    .rig-img-lg img { width: 100%; height: 100%; object-fit: cover; }
    .rig-img-sm {
        height: 150px; border-radius: 8px; overflow: hidden; border: 1px solid #1a2a40;
    }
    .rig-img-sm img { width: 100%; height: 100%; object-fit: cover; }
    
    /* Mobile */
    @media(max-width: 900px) {
        .dd-header { height: auto; flex-direction: column; text-align: center; padding-top: 120px; }
        .dd-image { margin: 40px 0 0 0; height: 400px; justify-content: center; }
        .dd-bg-number { font-size: 300px; top: 60%; right: 50%; transform: translate(50%, -50%); }
        .dd-info { padding: 0; }
        .dd-meta { justify-content: center; }
        .dd-rig-grid { grid-template-columns: 1fr; }
    }
</style>

<div style="width: 100%; overflow-x: hidden;"> <!-- Wrapper für Full Width -->
    
    <!-- HEADER (Full Width) -->
    <div class="dd-header">
        <div class="dd-bg-number">{{ driver.number or '00' }}</div>
        
        <div class="dd-info">
            <div class="dd-stripes-top">
                <div class="stripe short"></div>
                <div class="stripe"></div>
            </div>
            <div class="dd-name">
                <span class="dd-firstname-style">{{ driver.name.split(' ')[0] }}</span>
                <span class="dd-lastname">{{ driver.name.split(' ')[1:] | join(' ') }}</span>
            </div>
            
            <div class="dd-meta">
                {% if driver.nationality %}
                <span><span class="fi fi-{{ driver.nationality.lower() }}"></span> {{ driver.nationality.upper() }}</span>
                {% endif %}
                <span class="separator">|</span>
                {% if driver.twitch %}
                <span class="highlight">{{ driver.twitch.split('/')[-1] }}</span>
                {% else %}
                <span>{{ driver.name }}</span>
                {% endif %}
                <span class="separator">|</span>
                <span class="highlight">#{{ driver.number or '00' }}</span>
            </div>
            
            <div class="dd-stripes-bottom">
                <div class="stripe-b short"></div>
                <div class="stripe-b"></div>
            </div>
        </div>

        <div class="dd-image">
            {% if driver.image_url %}
            <img src="{{ driver.image_url }}" alt="{{ driver.name }}">
            {% else %}
            <!-- Fallback Driver Image (Silhouette) -->
            <img src="{{ url_for('static', filename='img/driver_silhouette.png') }}" style="opacity: 0.1;" alt="Driver">
            {% endif %}
        </div>
    </div>

</div> <!-- End Full Width Wrapper -->

<div class="dd-container">

    <!-- TWITCH BAR (Nur wenn Twitch hinterlegt ist) -->
    {% if driver.twitch %}
    <div class="dd-twitch-bar">
        <div class="dd-twitch-user">
            <i class="fab fa-twitch dd-twitch-icon"></i>
            {{ driver.twitch.split('/')[-1] }}
        </div>
        <div class="dd-twitch-status">
            <div class="status-badge">
                <div class="status-dot"></div> Off Air
            </div>
            <a href="{{ driver.twitch }}" target="_blank" class="twitch-link-btn">
                Zum Kanal <i class="fas fa-external-link-alt"></i>
            </a>
        </div>
    </div>
    {% else %}
    <!-- Abstandshalter wenn kein Twitch, damit Content nicht am Hero klebt -->
    <div style="margin-top: 60px;"></div>
    {% endif %}

    <!-- RACES TABLE -->
    <h2 class="dd-section-title">Absolvierte Rennen</h2>
    <div class="dd-table-container">
        <table class="dd-table">
            <thead>
                <tr>
                    <th>Datum</th>
                    <th>Event</th>
                    <th>Serie</th>
                    <th>Fahrzeug</th>
                    <th>Ergebnis</th>
                </tr>
            </thead>
            <tbody>
                {% if past_events %}
                    {% for event in past_events %}
                    <tr>
                        <td>{{ event.date.split('T')[0] }} {{ event.date.split('T')[1][:5] }}</td>
                        <td>{{ event.title }}</td>
                        <td>{{ event.series or '-' }}</td>
                        <td>{{ event.car_model or '-' }}</td>
                        <td class="res-badge">{{ event.result or '-' }}</td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr><td colspan="5" style="text-align: center;">Keine Rennen gefunden.</td></tr>
                {% endif %}
            </tbody>
        </table>
    </div>

    <!-- RIG SHOWCASE (New Style Box) -->
    {% if driver.rig %}
    <div class="dd-rig-section">
        <div class="dd-rig-header">
            <i class="fas fa-microchip" style="font-size: 2rem; color: var(--rdf-teal);"></i>
            <h2>Sim Rig Setup</h2>
        </div>
        <div class="dd-rig-content">
            <div class="dd-rig-grid" style="margin-bottom: 0;">
                <!-- Specs List -->
                <div class="dd-rig-specs" style="border: none; background: transparent; padding: 0;">
                    {% if driver.rig.type %}
                    <div class="spec-row"><span class="spec-key">Cockpit</span><span class="spec-val">{{ driver.rig.type }}</span></div>
                    {% endif %}
                    {% if driver.rig.monitors %}
                    <div class="spec-row"><span class="spec-key">Monitore</span><span class="spec-val">{{ driver.rig.monitors }}</span></div>
                    {% endif %}
                    {% if driver.rig.base %}
                    <div class="spec-row"><span class="spec-key">Wheelbase</span><span class="spec-val">{{ driver.rig.base }}</span></div>
                    {% endif %}
                    {% if driver.rig.wheel %}
                    <div class="spec-row"><span class="spec-key">Lenkrad</span><span class="spec-val">{{ driver.rig.wheel }}</span></div>
                    {% endif %}
                    {% if driver.rig.pedals %}
                    <div class="spec-row"><span class="spec-key">Pedale</span><span class="spec-val">{{ driver.rig.pedals }}</span></div>
                    {% endif %}
                    {% if driver.rig.extras %}
                    <div class="spec-row"><span class="spec-key">Extras</span><span class="spec-val">{{ driver.rig.extras }}</span></div>
                    {% endif %}
                </div>

                <!-- Gallery -->
                <div class="dd-rig-gallery">
                    {% if driver.rig.images %}
                        {% for img in driver.rig.images %}
                            {% if loop.index == 1 %}
                            <div class="rig-img-lg"><a href="#img-{{ loop.index }}"><img src="{{ img }}"></a></div>
                            {% else %}
                            <div class="rig-img-sm"><a href="#img-{{ loop.index }}"><img src="{{ img }}"></a></div>
                            {% endif %}
                            
                            <!-- Lightbox -->
                            <div id="img-{{ loop.index }}" class="lightbox">
                                <a href="#!" class="close-lightbox"></a>
                                <div class="lightbox-content">
                                    <img src="{{ img }}" style="border: none; box-shadow: 0 0 50px rgba(0,0,0,0.8);">
                                    <a href="#!" class="close-btn">&times;</a>
                                </div>
                            </div>
                        {% endfor %}
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    {% endif %}

</div>

<!-- CSS for Lightbox reuse -->
<style>
    .lightbox {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(5, 11, 20, 0.95);
        z-index: 9999; display: none; align-items: center; justify-content: center;
    }
    .lightbox:target { display: flex; animation: fadeIn 0.3s; }
    .lightbox-content { position: relative; max-width: 90%; max-height: 90%; }
    .lightbox-content img { max-width: 100%; max-height: 85vh; border-radius: 4px; }
    .close-lightbox { position: absolute; top: 0; left: 0; width: 100%; height: 100%; cursor: default; }
    .close-btn { position: absolute; top: -50px; right: 0; color: white; font-size: 2.5rem; text-decoration: none; opacity: 0.7; }
    .close-btn:hover { opacity: 1; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
</style>
{% endblock %}