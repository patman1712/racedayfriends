{% extends "base.html" %}

{% block content %}
<!-- Custom Driver Detail CSS -->
<style>
    /* Global Page Override removed to match Home */
    /* body { background-color: #050b14; } */
    
    .dd-container {
        max-width: 1400px; margin: 0 auto; padding: 0 40px;
    }

    /* HEADER SECTION */
    .dd-header {
        position: relative;
        height: 85vh;
        min-height: 600px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding-top: 80px;
        padding-bottom: 0 !important; /* WICHTIG: Kein Padding unten! */
        overflow: hidden;
        /* Hellerer, blauerer Verlauf wie im Screenshot */
        background: linear-gradient(135deg, #0B1829 0%, #15273d 100%);
    }

    /* Dotted Pattern Overlay (Nur rechts bei Bild/Nummer) */
    .dd-header::before {
        content: "";
        position: absolute; top: 0; right: 0; width: 60%; height: 100%; /* Nur rechte 60% */
        background-image: radial-gradient(rgba(255, 255, 255, 0.15) 1.5px, transparent 1.5px);
        background-size: 20px 20px;
        opacity: 0.6;
        pointer-events: none;
        z-index: 1;
        mask-image: linear-gradient(to right, transparent, black 20%); /* Weicher Übergang links */
        -webkit-mask-image: linear-gradient(to right, transparent, black 20%);
    }

    /* Background Number (21) */
    .dd-bg-number {
        position: absolute;
        top: 50%; right: 15%;
        transform: translateY(-50%);
        font-family: 'Teko', sans-serif;
        font-size: 900px; /* Extrem Groß (vorher 700px) */
        font-weight: 700;
        color: rgba(0, 0, 0, 0.2);
        line-height: 1;
        z-index: 0;
        pointer-events: none;
        text-align: center;
        width: 40%;
    }

    /* Left Info (Hamilton Style: Block links, aber Inhalt zentriert) */
    .dd-info {
        position: relative; z-index: 2;
        padding-left: 0;
        width: 45%;
        margin-left: 5%;
        display: flex; flex-direction: column; 
        justify-content: center; align-items: center; /* Inhalt zentriert */
        text-align: center;
    }
    
    /* Racing Stripes (Alonso Style) - Zentriert im Block */
    .dd-stripes-top {
        display: flex; gap: 10px; margin-bottom: 60px; /* Noch mehr Abstand (vorher 30/40) */
        transform: skewY(-20deg);
        height: 100px;
        align-items: flex-end;
        margin-left: 0; /* Reset */
    }
    .stripe {
        width: 18px; height: 100%; background: white;
        clip-path: polygon(0 0, 100% 0, 100% 85%, 0 100%);
    }
    .stripe.short { height: 60%; background: var(--rdf-teal); }
    
    .dd-stripes-bottom {
        display: flex; gap: 10px; margin-top: 30px;
        transform: skewY(-20deg);
        height: 100px;
        align-items: flex-start;
        margin-left: 0; /* Reset */
    }
    .stripe-b {
        width: 18px; height: 100%; background: white;
        clip-path: polygon(0 15%, 100% 0, 100% 100%, 0 100%);
    }
    .stripe-b.short { height: 60%; background: var(--rdf-teal); clip-path: polygon(0 25%, 100% 0, 100% 100%, 0 100%); }

    /* Name Styles */
    .dd-name { line-height: 0.8; margin-bottom: 20px; }
    .dd-firstname-style {
        font-family: 'Great Vibes', cursive; font-size: 6rem; color: white; display: block; margin-bottom: 15px;
        margin-left: 0; /* Reset */
    }
    .dd-lastname {
        font-family: 'Teko', sans-serif; font-size: 8rem; color: white;
        font-weight: 800; text-transform: uppercase; display: block; letter-spacing: 2px;
        line-height: 0.8;
    }
    
    /* Meta Line */
    .dd-meta {
        display: flex; align-items: center; justify-content: center; /* Zentriert */
        gap: 25px; margin-top: 15px;
        font-family: 'Rajdhani', sans-serif; font-size: 1.3rem; color: white; font-weight: 600;
        position: relative; z-index: 3;
    }
    .dd-meta span { display: flex; align-items: center; gap: 10px; }
    
    /* FIX: Runde Flagge */
    .dd-meta .fi {
        display: inline-block;
        width: 32px !important; height: 32px !important;
        border-radius: 50% !important;
        background-size: cover; background-position: center;
        box-shadow: 0 0 0 2px white; /* Weißer Ring */
        flex-shrink: 0;
    }
    .dd-meta .highlight { color: var(--rdf-teal); font-weight: bold; font-size: 1.3rem; letter-spacing: 1px; }
    .separator { color: #4a5568; font-weight: 300; opacity: 0.5; }

    /* Right Image (Hard Reset: Absolute Positionierung & Skalierung) */
    .dd-image {
        position: absolute;
        right: 5%; 
        bottom: 0;
        top: 100px;
        width: 55%; /* Breiterer Container */
        z-index: 2;
        pointer-events: none;
    }
    .dd-image img {
        position: absolute;
        bottom: -5px; /* Zieht es sicher unter den Rand */
        left: 50%;
        transform: translateX(-50%) scale(1.3); /* 30% Größer! */
        transform-origin: bottom center; /* Skaliert von unten nach oben */
        max-height: 100%; 
        max-width: 100%;
        width: auto;
        height: auto;
        display: block;
        filter: drop-shadow(0 10px 40px rgba(0,0,0,0.6));
    }

    /* Sim Rig Box (Angepasst an Table Style) */
    .dd-rig-section {
        /* Nutzt .dd-content-box Style */
        margin-top: 0; /* Abstand wird durch margin-bottom des vorherigen Elements geregelt */
        background: #0B1829;
        border: 1px solid #1a2a40; /* Gleicher Border wie Table */
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    }
    .dd-rig-header {
        /* Header entfernen oder anpassen, wir nutzen jetzt .dd-section-title davor */
        display: none; 
    }
    .dd-rig-content { padding: 30px; }

    /* TWITCH BAR (Redesign - Fixed Layout) */
    .dd-twitch-bar {
        background: #0f1c2e;
        border: 1px solid #1a2a40;
        border-radius: 8px;
        padding: 15px 25px;
        display: flex; 
        justify-content: space-between; /* Links vs Rechts */
        align-items: center;
        flex-wrap: nowrap; /* Zwingend eine Zeile */
        margin-top: 80px;
        margin-bottom: 60px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.4);
    }
    
    /* Linke Seite (Logo + Name) */
    .dd-twitch-user {
        display: flex; align-items: center; gap: 15px;
        font-family: 'Teko', sans-serif; font-size: 1.6rem; color: white; text-transform: uppercase; letter-spacing: 1px;
        font-weight: 600;
        white-space: nowrap; /* Kein Umbruch im Namen */
    }
    
    .dd-twitch-icon {
        color: #9146FF; font-size: 1.8rem;
    }
    
    /* Rechte Seite (Badge + Link) */
    .dd-twitch-status {
        display: flex; align-items: center; gap: 20px;
        white-space: nowrap; /* Kein Umbruch rechts */
    }
    
    .status-badge {
        background: rgba(255,255,255,0.05); color: #a0aec0;
        padding: 6px 12px; border-radius: 4px; /* Eckiger, kompakter */
        font-size: 0.75rem; font-weight: 700; letter-spacing: 1px;
        display: flex; align-items: center; gap: 8px; text-transform: uppercase;
        border: 1px solid rgba(255,255,255,0.1);
    }
    .status-dot { width: 6px; height: 6px; background: #a0aec0; border-radius: 50%; }
    
    .status-badge.live {
        background: rgba(255, 0, 0, 0.1); color: #ff4d4d; border-color: rgba(255,0,0,0.2);
    }
    .status-badge.live .status-dot { background: #ff4d4d; box-shadow: 0 0 8px #ff4d4d; }
    
    .twitch-link-btn {
        color: #a0aec0; text-decoration: none; font-size: 0.9rem;
        display: flex; align-items: center; gap: 8px; transition: color 0.2s;
        font-family: 'Rajdhani', sans-serif; font-weight: 600;
    }
    .twitch-link-btn:hover { color: white; }
    
    /* Mobile Twitch Bar - NUR auf Mobile umbrechen */
    @media(max-width: 900px) {
        .dd-twitch-bar {
            flex-direction: column; gap: 15px; text-align: center;
            padding: 20px; margin-top: 40px;
        }
        .dd-twitch-status { flex-direction: column; gap: 15px; }
    }

    /* SECTIONS & BOXES (Unified Design) */
    .dd-section-title {
        font-family: 'Teko', sans-serif; font-size: 3rem; color: white; text-transform: uppercase;
        margin-bottom: 20px; padding-left: 20px; border-left: 5px solid var(--rdf-teal); line-height: 1;
        display: flex; align-items: center; gap: 15px;
    }
    
    /* Unified Box Style for Table & Rig */
    .dd-content-box {
        background: #0B1829; 
        border: 1px solid #1a2a40; 
        border-radius: 8px; 
        overflow: hidden;
        margin-bottom: 60px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    }

    /* TABLE */
    .dd-table-container {
        /* Erbt jetzt von .dd-content-box, aber wir behalten spezifische Styles */
        background: #0B1829; border: 1px solid #1a2a40; border-radius: 8px; overflow: hidden;
        margin-bottom: 60px;
    }
    .dd-table { width: 100%; border-collapse: collapse; }
    .dd-table th {
        text-align: left; padding: 20px; background: #0f1c2e; color: white; font-weight: 700;
        text-transform: uppercase; font-size: 0.9rem; border-bottom: 1px solid #1a2a40;
    }
    .dd-table td {
        padding: 20px; border-bottom: 1px solid #1a2a40; color: var(--rdf-silver); font-size: 0.95rem;
    }
    .dd-table tr:last-child td { border-bottom: none; }
    .dd-table tr:hover td { background: rgba(255,255,255,0.02); color: white; }
    
    .res-badge { color: var(--rdf-teal); font-weight: bold; }
    
    /* RIG SECTION (New) */
    .dd-rig-grid {
        display: grid; grid-template-columns: 1fr 1fr; gap: 40px; margin-bottom: 80px;
    }
    .dd-rig-specs {
        background: #0B1829; padding: 30px; border-radius: 8px; border: 1px solid #1a2a40;
    }
    .spec-row {
        display: flex; justify-content: space-between; padding: 15px 0; border-bottom: 1px solid rgba(255,255,255,0.05);
    }
    .spec-row:last-child { border-bottom: none; }
    .spec-key { color: var(--rdf-silver); text-transform: uppercase; font-size: 0.9rem; }
    .spec-val { color: white; font-weight: 600; text-align: right; }
    
    .dd-rig-gallery {
        display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;
    }
    .rig-img-lg {
        grid-column: span 2; height: 300px; border-radius: 8px; overflow: hidden; border: 1px solid #1a2a40;
    }
    .rig-img-lg img { width: 100%; height: 100%; object-fit: cover; }
    .rig-img-sm {
        height: 150px; border-radius: 8px; overflow: hidden; border: 1px solid #1a2a40;
    }
    .rig-img-sm img { width: 100%; height: 100%; object-fit: cover; }
    
    /* Mobile Media Query Fix */
    @media(max-width: 900px) {
        .dd-header { 
            height: auto; 
            min-height: 100vh;
            flex-direction: column; 
            justify-content: flex-start;
            padding-top: 100px;
            padding-bottom: 0;
        }
        
        .dd-info {
            width: 100%; margin: 0; padding: 0 20px;
            z-index: 5;
            align-items: center; /* Zentriert auf Mobile */
            text-align: center;
        }
        
        .dd-stripes-top, .dd-stripes-bottom { margin-left: 0; } /* Reset Einrückung */
        
        .dd-image {
            position: relative; /* Relative auf Mobile! */
            right: auto; bottom: auto; top: auto;
            width: 100%; height: 50vh;
            margin-top: 20px;
            justify-content: center;
            align-items: flex-end;
            pointer-events: none;
        }
        .dd-image img {
            position: relative; /* Relative auf Mobile */
            left: auto; bottom: auto; transform: none;
            max-height: 100%; width: auto;
            mask-image: linear-gradient(to bottom, black 80%, transparent 100%);
            -webkit-mask-image: linear-gradient(to bottom, black 80%, transparent 100%);
        }
        
        .dd-bg-number { font-size: 300px; top: 20%; right: 50%; transform: translateX(50%); opacity: 0.5; width: auto; }
        
        /* Twitch Bar Mobile */
        .dd-twitch-bar {
            flex-direction: column; gap: 15px; text-align: center;
            padding: 20px; margin-top: 40px;
        }
        .dd-twitch-right { flex-direction: column; gap: 15px; white-space: normal; }
        
        .dd-table-container { overflow-x: auto; }
        .dd-rig-grid { grid-template-columns: 1fr; }
    }
</style>

<div style="width: 100%; overflow-x: hidden;"> <!-- Wrapper für Full Width -->
    
    <!-- HEADER (Full Width) -->
    <div class="dd-header">
        <div class="dd-bg-number">{{ driver.number or '00' }}</div>
        
        <div class="dd-info">
            <div class="dd-stripes-top">
                <div class="stripe short"></div>
                <div class="stripe"></div>
            </div>
            <div class="dd-name">
                <span class="dd-firstname-style">{{ driver.name.split(' ')[0] }}</span>
                <span class="dd-lastname">{{ driver.name.split(' ')[1:] | join(' ') }}</span>
            </div>
            
            <div class="dd-meta">
                {% if driver.nationality %}
                <span><span class="fi fi-{{ driver.nationality.lower() }}"></span> {{ driver.nationality.upper() }}</span>
                {% endif %}
                <span class="separator">|</span>
                {% if driver.twitch %}
                <span class="highlight">{{ driver.twitch.split('/')[-1] }}</span>
                {% else %}
                <span>{{ driver.name }}</span>
                {% endif %}
                <span class="separator">|</span>
                <span class="highlight">#{{ driver.number or '00' }}</span>
            </div>
            
            <div class="dd-stripes-bottom">
                <div class="stripe-b short"></div>
                <div class="stripe-b"></div>
            </div>
        </div>

        <div class="dd-image">
            {% if driver.image_url %}
            <img src="{{ driver.image_url }}" alt="{{ driver.name }}">
            {% else %}
            <!-- Fallback Driver Image (Silhouette) -->
            <img src="{{ url_for('static', filename='img/driver_silhouette.png') }}" style="opacity: 0.1;" alt="Driver">
            {% endif %}
        </div>
    </div>

</div> <!-- End Full Width Wrapper -->

<div class="dd-container">

    <!-- TWITCH BAR (Nur wenn Twitch hinterlegt ist) -->
    {% if driver.twitch %}
    <div class="dd-twitch-bar">
        <div class="dd-twitch-user">
            <i class="fab fa-twitch dd-twitch-icon"></i>
            {{ driver.twitch.split('/')[-1] }}
        </div>
        <div class="dd-twitch-right"> <!-- Korrekter Klassenname -->
            <div class="status-badge">
                <div class="status-dot"></div> Off Air
            </div>
            <a href="{{ driver.twitch }}" target="_blank" class="twitch-link-btn">
                Zum Kanal <i class="fas fa-external-link-alt"></i>
            </a>
        </div>
    </div>
    {% else %}
    <!-- Abstandshalter wenn kein Twitch, damit Content nicht am Hero klebt -->
    <div style="margin-top: 60px;"></div>
    {% endif %}

    <!-- RACES TABLE -->
    <h2 class="dd-section-title">Absolvierte Rennen</h2>
    <div class="dd-content-box"> <!-- Unified Class -->
        <table class="dd-table">
            <thead>
                <tr>
                    <th>Datum</th>
                    <th>Event</th>
                    <th>Serie</th>
                    <th>Fahrzeug</th>
                    <th>Ergebnis</th>
                </tr>
            </thead>
            <tbody>
                {% if past_events %}
                    {% for event in past_events %}
                    <tr>
                        <td data-label="Datum">{{ event.date.split('T')[0] }} {{ event.date.split('T')[1][:5] }}</td>
                        <td data-label="Event">{{ event.title }}</td>
                        <td data-label="Serie">{{ event.series or '-' }}</td>
                        <td data-label="Fahrzeug">{{ event.car_model or '-' }}</td>
                        <td data-label="Ergebnis" class="res-badge">{{ event.result or '-' }}</td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr><td colspan="5" style="text-align: center;">Keine Rennen gefunden.</td></tr>
                {% endif %}
            </tbody>
        </table>
    </div>

    <!-- RIG SHOWCASE (New Style Box) -->
    {% if driver.rig %}
    <h2 class="dd-section-title"><i class="fas fa-microchip" style="color: var(--rdf-teal); font-size: 0.8em;"></i> Sim Rig Setup</h2>
    <div class="dd-content-box"> <!-- Unified Class -->
        <div class="dd-rig-content">
            <div class="dd-rig-grid" style="margin-bottom: 0;">
                <!-- Specs List -->
                <div class="dd-rig-specs" style="border: none; background: transparent; padding: 0;">
                    {% if driver.rig.type %}
                    <div class="spec-row"><span class="spec-key">Cockpit</span><span class="spec-val">{{ driver.rig.type }}</span></div>
                    {% endif %}
                    {% if driver.rig.monitors %}
                    <div class="spec-row"><span class="spec-key">Monitore</span><span class="spec-val">{{ driver.rig.monitors }}</span></div>
                    {% endif %}
                    {% if driver.rig.base %}
                    <div class="spec-row"><span class="spec-key">Wheelbase</span><span class="spec-val">{{ driver.rig.base }}</span></div>
                    {% endif %}
                    {% if driver.rig.wheel %}
                    <div class="spec-row"><span class="spec-key">Lenkrad</span><span class="spec-val">{{ driver.rig.wheel }}</span></div>
                    {% endif %}
                    {% if driver.rig.pedals %}
                    <div class="spec-row"><span class="spec-key">Pedale</span><span class="spec-val">{{ driver.rig.pedals }}</span></div>
                    {% endif %}
                    {% if driver.rig.extras %}
                    <div class="spec-row"><span class="spec-key">Extras</span><span class="spec-val">{{ driver.rig.extras }}</span></div>
                    {% endif %}
                </div>

                <!-- Gallery -->
                <div class="dd-rig-gallery">
                    {% if driver.rig.images %}
                        {% for img in driver.rig.images %}
                            {% if loop.index == 1 %}
                            <div class="rig-img-lg"><a href="#img-{{ loop.index }}"><img src="{{ img }}"></a></div>
                            {% else %}
                            <div class="rig-img-sm"><a href="#img-{{ loop.index }}"><img src="{{ img }}"></a></div>
                            {% endif %}
                            
                            <!-- Lightbox -->
                            <div id="img-{{ loop.index }}" class="lightbox">
                                <a href="#!" class="close-lightbox"></a>
                                <div class="lightbox-content">
                                    <img src="{{ img }}" style="border: none; box-shadow: 0 0 50px rgba(0,0,0,0.8);">
                                    <a href="#!" class="close-btn">&times;</a>
                                </div>
                            </div>
                        {% endfor %}
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    {% endif %}

</div>

<!-- CSS for Lightbox reuse -->
<style>
    .lightbox {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(5, 11, 20, 0.95);
        z-index: 9999; display: none; align-items: center; justify-content: center;
    }
    .lightbox:target { display: flex; animation: fadeIn 0.3s; }
    .lightbox-content { position: relative; max-width: 90%; max-height: 90%; }
    .lightbox-content img { max-width: 100%; max-height: 85vh; border-radius: 4px; }
    .close-lightbox { position: absolute; top: 0; left: 0; width: 100%; height: 100%; cursor: default; }
    .close-btn { position: absolute; top: -50px; right: 0; color: white; font-size: 2.5rem; text-decoration: none; opacity: 0.7; }
    .close-btn:hover { opacity: 1; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
</style>
{% endblock %}